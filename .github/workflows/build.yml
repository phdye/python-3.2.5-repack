name: Build Python 3.2.5

on:
  push:
    tags:
      - "v*"

jobs:
  build:
    strategy:
      matrix:
        os: [ubuntu-20.04, ubuntu-22.04]
    runs-on: ${{ matrix.os }}
    steps:
      - uses: actions/checkout@v3

      - name: Install build dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential wget perl

      - name: Run all build scripts
        run: |
          chmod +x scripts/*.sh
          ./scripts/build-openssl.sh
          ./scripts/build-gdbm.sh
          ./scripts/build-python.sh
          ./scripts/populate-site-packages.sh

      - name: Package output
        run: |
          cd $HOME/sysroot
          sudo tar -cJf ${{ github.workspace }}/python-3.2.5-${{ matrix.os }}.tar.xz .

      - name: Upload binary
        uses: softprops/action-gh-release@v1
        with:
          files: python-3.2.5-${{ matrix.os }}.tar.xz
